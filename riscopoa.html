<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Annita - Crimes Sexuais em Porto Alegre</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      margin: 0;
      background-color: #f4f4f9;
    }
    #map {
      height: 600px;
      width: 100%;
      border-radius: 12px;
      margin-top: 10px;
    }
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #0069d9;
      color: white;
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .toolbar h1 {
      font-size: 1.5rem;
      margin: 0;
    }
    .search-box input {
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 250px;
    }
    #safeMessage {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #d4edda;
      color: #155724;
      padding: 20px 30px;
      border: 2px solid #c3e6cb;
      border-radius: 12px;
      font-size: 1.2rem;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
      z-index: 9999;
      display: none;
    }
    #crimeIndex {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 1rem;
      font-size: 0.9rem;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      max-width: 250px;
      z-index: 5000;
    }
    #crimeIndex h2 {
      margin-top: 0;
      font-size: 1rem;
      color: #333;
    }
    #crimeIndex ul {
      margin: 0;
      padding-left: 1.2rem;
    }
    #anitaTexto {
      max-width: 900px;
      margin: 100vh auto 2rem auto;
      background-color: #ffffff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      line-height: 1.6;
      font-size: 1rem;
      color: #333;
      white-space: pre-line;
    }
  </style>
</head>
<body>

  <div class="toolbar">
    <h1>Annita</h1>
    <div class="search-box">
      <input type="text" id="search" placeholder="Buscar por crime, bairro ou cidade..." />
    </div>
    <div>
      <input type="file" id="csvUpload" accept=".csv" />
    </div>
  </div>

  <div id="map"></div>
  <div id="safeMessage">✅ Você está em uma região segura no momento.</div>
  <div id="crimeIndex">
    <h2>Índice de crimes:</h2>
    <ul id="crimeList"></ul>
  </div>

  <div id="anitaTexto">
    Biografia de Anita Garibaldi

    Anita Garibaldi (1821-1849) foi a "Heroína dos Dois Mundos". Recebeu esse título por ter participado, no Brasil e na Itália, ao lado de seu marido Giuseppe Garibaldi, de diversas batalhas. Lutou na Revolução Farroupilha (Guerra dos Farrapos), na Batalha dos Curitibanos e na Batalha de Gianicolo, na Itália. 

Ana Maria de Jesus Ribeiro, conhecida como Anita Garibaldi, nasceu em Morrinhos, então município de Laguna, Santa Catarina, no dia 30 de agosto de 1821. Era filha de Bento Ribeiro da Silva, um modesto comerciante de Laguna, descendente de família portuguesa vinda dos Açores, e de Maria Antônia de Jesus. 

Com a morte de seu pai, Ana foi obrigada a se casar com o sapateiro Manuel Duarte de Aguiar. No dia 30 de agosto de 1835, com apenas 14 anos, casou-se na Igreja Matriz de Santo Antônio dos Anjos. O casamento durou apenas três anos, pois o marido se alistou no exército imperial e Ana voltou para casa de sua mãe.

  Anita e Giuseppe Garibaldi
Em 1839, Ana conheceu Giuseppe Garibaldi, general italiano que desembarcou no Rio de Janeiro, em 1835, fugindo de seu país, após se unir ao movimento “Jovem Itália”, e lutar pela independência dos Estados espalhados pela península italiana.

Com o fracasso do golpe, Garibaldi foi condenado à morte, começando então uma vida de exílio. Refugiou-se na França e depois veio para o Brasil, onde já se encontravam outros exilados italianos. Participou de lutas e revoluções que influíram decisivamente em seu futuro.

No Rio de Janeiro, Garibaldi participou de uma companhia de navegação de cabotagem. No Rio Grande do Sul aderiu à Guerra dos Farrapos – movimento rebelde do período regencial no qual os gaúchos tutavam pela autonomia da província, contra os altos impostos e o desinteresse do governo central pelos problemas locais.

A Guerra dos Farrapos, também conhecida como Revolução Farroupilha, durou dez anos, tomou a cidade de Porto Alegre, e com o apoio da Assembleia Provincial, em 1836, proclamou a República de Piratini. Com o auxílio de Garibaldi o movimento se propagou. Em 1839 foi proclamada, em Santa Catarina, a República Juliana.  

Nesses anos de guerra, Ana Ribeiro da Silva, que também lutava na revolução, conheceu Giuseppe Garibaldi, que passou a lhe chamar de Anita (pequena Ana em italiano). Unida a Garibaldi, participou ativamente do combate em Imbituba, Santa Catarina e da batalha de Laguna quando carregou e disparou um canhão.

Durante a Batalha de Curitibanos, Anita foi capturada pelas tropas do Império. Grávida de seu primeiro filho foi informada que seu marido estava morto. Inconformada, conseguiu fugir a cavalo e saiu a sua procura, localizando-o vivo na cidade de Vacaria.

Casamento
Giuseppe e Anita foram perseguidos pela Marinha do Império até fugirem para o Uruguai, onde ela passou a se dedicar ao lar. No dia 16 de setembro de 1840 nasceu seu filho Domênico Menotti. O casal teve mais dois filhos, Teresita e Ricciott. Em 20 de maro de 1842, casaram-se na paróquia de San Bernardino, em Montevidéu.

Batalhas na Itália
Em 1847, Garibaldi enviou Anita e os filhos para a casa da mãe, em Nice. Em maio, Giuseppe  partiu com 63 integrantes dos "camisas vermelhas", a bordo do navio Esperança, a caminho da Itália. Na Itália, Anita acompanhou o marido nas lutas para a unificação do país, como na batalha do Gianicolo, demonstrando grande bravura.




    <div id="anitaTexto">` 

  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map', {
      center: [-30.0346, -51.2177],
      zoom: 12,
      zoomControl: false
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let crimes = [];
    let usuarioCoords = null;

    async function geocodificarEndereco(endereco) {
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(endereco)}`;
      const response = await fetch(url, {
        headers: { 'User-Agent': 'AnnitaCrimesRS/1.0' }
      });
      const data = await response.json();
      return data[0] ? [parseFloat(data[0].lat), parseFloat(data[0].lon)] : null;
    }

    function calcularDistancia(coord1, coord2) {
      const R = 6371;
      const dLat = (coord2[0] - coord1[0]) * Math.PI / 180;
      const dLon = (coord2[1] - coord1[1]) * Math.PI / 180;
      const a = Math.sin(dLat / 2) ** 2 +
                Math.cos(coord1[0] * Math.PI / 180) *
                Math.cos(coord2[0] * Math.PI / 180) *
                Math.sin(dLon / 2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    async function exibirCrimes(filtro = '') {
      map.eachLayer(layer => {
        if (layer instanceof L.CircleMarker) map.removeLayer(layer);
      });

      let crimesProximos = 0;
      const contagem = {};

      for (const crime of crimes) {
        if (
          !filtro ||
          crime.tipo.toLowerCase().includes(filtro.toLowerCase()) ||
          crime.rua.toLowerCase().includes(filtro.toLowerCase())
        ) {
          const coords = await geocodificarEndereco(crime.rua);
          if (coords) {
            L.circleMarker(coords, {
              radius: 7,
              color: 'red',
              fillColor: '#f03',
              fillOpacity: 0.6
            }).addTo(map)
              .bindPopup(`
                <strong>${crime.tipo}</strong><br>
                ${crime.data} ${crime.hora}<br>
                ${crime.rua}<br>
              `);

            contagem[crime.tipo] = (contagem[crime.tipo] || 0) + 1;

            if (usuarioCoords) {
              const distancia = calcularDistancia(usuarioCoords, coords);
              if (distancia <= 2) crimesProximos++;
            }
          }
        }
      }

      const msg = document.getElementById('safeMessage');
      msg.style.display = (usuarioCoords && crimesProximos === 0) ? 'block' : 'none';

      atualizarIndice(contagem);
    }

    function atualizarIndice(contagem) {
      const lista = document.getElementById('crimeList');
      lista.innerHTML = '';
      for (const tipo in contagem) {
        const item = document.createElement('li');
        item.textContent = `${contagem[tipo]} - ${tipo}`;
        lista.appendChild(item);
      }
    }

    document.getElementById('search').addEventListener('input', function () {
      const filtro = this.value.trim();
      exibirCrimes(filtro);
    });

    document.getElementById('csvUpload').addEventListener('change', function (e) {
      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = function (event) {
        const csvText = event.target.result;
        const linhas = csvText.trim().split('\n').slice(1);

        crimes = linhas
          .map(linha => {
            const colunas = linha.split(';');
            const tipo = colunas[4]?.trim().toLowerCase();
            const cidade = colunas[6]?.trim().toLowerCase();
            const bairro = colunas[8]?.trim();
            const data = colunas[1]?.trim();
            const hora = colunas[2]?.trim();

            const tiposPermitidos = ['estupro', 'assédio', 'importunação', 'pedofilia'];
            const ehCrimePermitido = tiposPermitidos.some(tp => tipo?.includes(tp));
            const ehPortoAlegre = cidade === 'porto alegre';

            if (ehCrimePermitido && ehPortoAlegre) {
              return {
                tipo: tipo.charAt(0).toUpperCase() + tipo.slice(1),
                data: data || '',
                hora: hora || '',
                cidade: 'Porto Alegre',
                bairro: bairro || '',
                rua: `${bairro}, Porto Alegre`,
                casos: 1
              };
            }

            return null;
          })
          .filter(item => item !== null);

        exibirCrimes();
      };

      reader.readAsText(file);
    });

    navigator.geolocation.getCurrentPosition(
      pos => {
        usuarioCoords = [pos.coords.latitude, pos.coords.longitude];
        L.marker(usuarioCoords).addTo(map).bindPopup("Você está aqui.");
      },
      err => {
        console.warn("Localização não permitida.");
      }
    );
  </script>
</body>
</html>
